!function(t){var i=function(i){var e=this;this.initialize_ui=function(){var t=i.$bundle_data.find(".wcsatt-options-wrapper");t.length>0&&(!1!==i.$addons_totals?i.$addons_totals.after(t):i.$bundle_price.after(t))},this.initialize_schemes=function(){i.satt_schemes=[];var e=i.$bundle_wrap.find(".wcsatt-options-product .subscription-option");t.each(e,function(e,s){var a=t(this),c=t(this).find("input").data("custom_data");i.satt_schemes.push({el:a,data:c,price_html:a.find(".subscription-price").html(),details_html:t("<div>").html(a.find(".subscription-details")).html()})})},this.integrate=function(){e.initialize_ui(),e.initialize_schemes(),i.$bundle_data.on("woocommerce-product-bundle-updated-totals",e.update_subscription_totals),i.$bundle_data.on("woocommerce-product-bundle-validation-status-changed",e.update_subscription_totals)},this.update_subscription_totals=function(i,s){s.satt_schemes.length>0&&t.each(s.satt_schemes,function(i,a){var c=s.get_price_html();if(1===s.satt_schemes.length&&0===s.$bundle_wrap.find(".wcsatt-options-product .one-time-option").length)s.$bundle_price.find(".price").html(t(c).html()+a.details_html);else{var o=a.el.find(".subscription-price");if(!0===a.data.overrides_price){var n=t.extend(!0,{},s.price_data);"inherit"===a.data.subscription_scheme.pricing_mode&&a.data.subscription_scheme.discount>0?(t.each(s.bundled_items,function(t,i){var e=i.bundled_item_id;a.data.discount_from_regular?n.prices[e]=n.regular_prices[e]*(1-a.data.subscription_scheme.discount/100):n.prices[e]=n.prices[e]*(1-a.data.subscription_scheme.discount/100),n.addons_prices[e]=n.addons_prices[e]*(1-a.data.subscription_scheme.discount/100)}),n.base_price=n.base_price*(1-a.data.subscription_scheme.discount/100)):"override"===a.data.subscription_scheme.pricing_mode&&(n.base_regular_price=Number(a.data.subscription_scheme.regular_price),n.base_price=Number(a.data.subscription_scheme.price)),n=s.calculate_subtotals(!1,n),n=s.calculate_totals(n),c=s.get_price_html(n)}s.passes_validation()?o.html(t(c).html()+a.details_html).find("span.total").remove():o.html(a.price_html),o.trigger("wcsatt-updated-bundle-price",[c,a,s,e])}})},this.integrate()},e=function(i){var e=this;this.initialize_ui=function(){var t=i.$composite_data.find(".wcsatt-options-wrapper");t.length>0&&(!1!==i.composite_price_view.$addons_totals?i.composite_price_view.$addons_totals.after(t):i.$composite_price.after(t))},this.initialize_schemes=function(){i.satt_schemes=[];var e=i.$composite_data.find(".wcsatt-options-product .subscription-option");t.each(e,function(e,s){var a=t(this),c=t(this).find("input").data("custom_data");i.satt_schemes.push({el:a,data:c,price_html:a.find(".subscription-price").html(),details_html:t("<div>").html(a.find(".subscription-details")).html()})})},this.integrate=function(){e.initialize_schemes(),i.actions.add_action("initialize_composite",function(){e.initialize_ui(),i.satt_schemes.length>0&&(i.satt_schemes.length>1||i.$composite_data.find(".composite_wrap .wcsatt-options-product .one-time-option").length>0?(i.actions.add_action("composite_totals_changed",e.update_subscription_totals,101,e),i.actions.add_action("composite_validation_status_changed",e.update_subscription_totals,101,e)):i.filters.add_filter("composite_price_html",e.filter_price_html,10,e))},51,this)},this.filter_price_html=function(e,s,a){var c=i.satt_schemes[0].details_html;return e=t(e).append(c).prop("outerHTML")},this.update_subscription_totals=function(){i.satt_schemes.length>0&&t.each(i.satt_schemes,function(s,a){var c=i.composite_price_view.get_price_html();if($scheme_price=a.el.find(".subscription-price"),!0===a.data.overrides_price){var o=t.extend(!0,{},i.data_model.price_data);"inherit"===a.data.subscription_scheme.pricing_mode&&a.data.subscription_scheme.discount>0?(t.each(i.get_components(),function(t,i){var e=i.component_id;a.data.discount_from_regular?o.prices[e]=o.regular_prices[e]*(1-a.data.subscription_scheme.discount/100):o.prices[e]=o.prices[e]*(1-a.data.subscription_scheme.discount/100),o.addons_prices[e]=o.addons_prices[e]*(1-a.data.subscription_scheme.discount/100)}),o.base_price=o.base_price*(1-a.data.subscription_scheme.discount/100)):"override"===a.data.subscription_scheme.pricing_mode&&(o.base_regular_price=Number(a.data.subscription_scheme.regular_price),o.base_price=Number(a.data.subscription_scheme.price)),o=i.data_model.calculate_subtotals(!1,o);var n=i.data_model.calculate_totals(o);o.totals=n,c=i.composite_price_view.get_price_html(o)}"pass"===i.api.get_composite_validation_status()?$scheme_price.html(t(c).html()+a.details_html).find("span.total").remove():$scheme_price.html(a.price_html),$scheme_price.trigger("wcsatt-updated-composite-price",[c,a,i,e])})},this.integrate()};t(".bundle_form .bundle_data").each(function(){t(this).on("woocommerce-product-bundle-initializing",function(t,e){e.is_composited()||new i(e)})}),t(".composite_form .composite_data").each(function(){t(this).on("wc-composite-initializing",function(t,i){new e(i)})})}(jQuery);